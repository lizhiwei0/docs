# 阿里云检测端TTFB 超长排查

## DNS解析 时间长?

*   确认方式
可是使用ping 命令通过 域名ping 服务器,看延迟情况.
从下面的记录来看 ping包的平均延迟就是不到4ms

      [http://ads.adroi.com.cn/jssearch.shtml](http://ads.adroi.com.cn/jssearch.shtml)

    [root@izuf62csouohae8m3be3h8z ~]&lt;span class="hljs-comment"&gt;# ping b.pingan.com.cn&lt;/span&gt;
PING pingansni.dtwscache.ourwebcdn.com (&lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt;) &lt;span class="hljs-number"&gt;56&lt;/span&gt;(&lt;span class="hljs-number"&gt;84&lt;/span&gt;) bytes of data.
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes from &lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt; (&lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt;): &lt;span class="hljs-variable"&gt;icmp_seq=&lt;/span&gt;&lt;span class="hljs-number"&gt;1&lt;/span&gt; &lt;span class="hljs-variable"&gt;ttl=&lt;/span&gt;&lt;span class="hljs-number"&gt;54&lt;/span&gt; &lt;span class="hljs-variable"&gt;time=&lt;/span&gt;&lt;span class="hljs-number"&gt;3.97&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes from &lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt; (&lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt;): &lt;span class="hljs-variable"&gt;icmp_seq=&lt;/span&gt;&lt;span class="hljs-number"&gt;2&lt;/span&gt; &lt;span class="hljs-variable"&gt;ttl=&lt;/span&gt;&lt;span class="hljs-number"&gt;54&lt;/span&gt; &lt;span class="hljs-variable"&gt;time=&lt;/span&gt;&lt;span class="hljs-number"&gt;3.69&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes from &lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt; (&lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt;): &lt;span class="hljs-variable"&gt;icmp_seq=&lt;/span&gt;&lt;span class="hljs-number"&gt;3&lt;/span&gt; &lt;span class="hljs-variable"&gt;ttl=&lt;/span&gt;&lt;span class="hljs-number"&gt;54&lt;/span&gt; &lt;span class="hljs-variable"&gt;time=&lt;/span&gt;&lt;span class="hljs-number"&gt;3.42&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes from &lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt; (&lt;span class="hljs-number"&gt;101.227&lt;/span&gt;.&lt;span class="hljs-number"&gt;176.41&lt;/span&gt;): &lt;span class="hljs-variable"&gt;icmp_seq=&lt;/span&gt;&lt;span class="hljs-number"&gt;4&lt;/span&gt; &lt;span class="hljs-variable"&gt;ttl=&lt;/span&gt;&lt;span class="hljs-number"&gt;54&lt;/span&gt; &lt;span class="hljs-variable"&gt;time=&lt;/span&gt;&lt;span class="hljs-number"&gt;3.42&lt;/span&gt; ms
^C
--- pingansni.dtwscache.ourwebcdn.com ping statistics ---
&lt;span class="hljs-number"&gt;4&lt;/span&gt; packets transmitted, &lt;span class="hljs-number"&gt;4&lt;/span&gt; received, &lt;span class="hljs-number"&gt;0&lt;/span&gt;% packet loss, time &lt;span class="hljs-number"&gt;3005&lt;/span&gt;ms
rtt min/avg/max/&lt;span class="hljs-variable"&gt;mdev =&lt;/span&gt; &lt;span class="hljs-number"&gt;3.420&lt;/span&gt;/&lt;span class="hljs-number"&gt;3.630&lt;/span&gt;/&lt;span class="hljs-number"&gt;3.975&lt;/span&gt;/&lt;span class="hljs-number"&gt;0.239&lt;/span&gt; ms
`&lt;/pre&gt;

    b.pingan.com.cn 这个域名对应了多台服务器每一台的性能不同,
比如这一台 103.224.182.243 ping包延时 289ms
那么TTFB 肯定 也不会好了去

    &lt;pre&gt;`[root@izuf62csouohae8m3be3h8z ~]&lt;span class="hljs-comment"&gt;# ping b.pingan.com.cm&lt;/span&gt;
PING b.pingan.com.cm (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;) &lt;span class="hljs-number"&gt;56&lt;/span&gt;(&lt;span class="hljs-number"&gt;84&lt;/span&gt;) bytes &lt;span class="hljs-keyword"&gt;of&lt;/span&gt; data.
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;1&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;289&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;2&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;289&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;3&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;289&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;4&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;289&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;5&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;290&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;6&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;289&lt;/span&gt; ms
&lt;span class="hljs-number"&gt;64&lt;/span&gt; bytes &lt;span class="hljs-keyword"&gt;from&lt;/span&gt; lb-&lt;span class="hljs-number"&gt;182&lt;/span&gt;-&lt;span class="hljs-number"&gt;243.&lt;/span&gt;&lt;span class="hljs-keyword"&gt;above&lt;/span&gt;.com (&lt;span class="hljs-number"&gt;103.224&lt;/span&gt;&lt;span class="hljs-number"&gt;.182&lt;/span&gt;&lt;span class="hljs-number"&gt;.243&lt;/span&gt;): icmp_seq=&lt;span class="hljs-number"&gt;7&lt;/span&gt; ttl=&lt;span class="hljs-number"&gt;47&lt;/span&gt; &lt;span class="hljs-property"&gt;time&lt;/span&gt;=&lt;span class="hljs-number"&gt;289&lt;/span&gt; ms